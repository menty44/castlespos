/** 
**	A Template for developing new terminal application
**/

#include <string.h>
#include <stdio.h>
#include <stdlib.h>
#include <stdarg.h>
/** These two files are necessary for calling CTOS API **/
#include <ctosapi.h>
#include <emvaplib.h>
#include <emvlib.h>
#include <time.h>

//#include <ctos_newlib_startup.h>
//#include <iccmifare.h>
//#include <tclcard.h>
#include <vwdleapi.h>

#define	d_BAUDRATE			38400
#define	d_MsessionFlag		0x00
#define d_AsessionFlag		0x01

#define d_EMV_PAYPASS_MSD_ONLINE				(USHORT)0x0001
#define d_EMV_CHIP_OFF_APPROVAL					(USHORT)0x0002
#define d_EMV_CHIP_OFF_DECLINED					(USHORT)0x0003
#define d_EMV_CHIP_ONL							(USHORT)0x0004
#define d_EMV_VISA_MSD_ONLINE                   (USHORT)0x0005

//EMV
#define d_BUFF_SIZE 128 
#define d_ONLINE_KEYSET         0x2001
#define d_ONLINE_KEYINDEX       0x0000
#define d_OFFLINE_KEYINDEX      0x0001
#define d_ONLINE_KEY            "\x11\x11\x11\x11\x11\x11\x11\x11\x11\x11\x11\x11\x11\x11\x11\x11"
#define d_EMV_CONFIG_FILE       "emv_config.xml"

BYTE CardSNbuf[128];
BYTE CardExpDatebuf1[32];
BYTE CardExpDatebuf2[128];
ULONG g_ulAMT = 0;
BOOL isOfflinePIN = FALSE;
BOOL isPIN_OK = FALSE;
BOOL isInsertPIN = FALSE;
static BYTE baAuthorizationCode[4]; 
static BYTE baIssuerAuthenticationData[128];
static BYTE baIssuerScript[256]; 

BYTE SelectedAID[16];

ULONG ulAPRtn;
USHORT usTxResult;

int iLen;
char baInput[20];
STR sBuf[1024], sBuf1[80];
BYTE baMem[10000], baTmp[5000], baBuf[128], baTemp[256], baTemp2[256], baTmp1[256];
RC_DATA stRCData;
BYTE baTVR1[8][43], baTVR2[8][53], baTVR3[8][61], baTVR4[8][52], baTVR5[8][50];
BYTE baTSI1[8][100], baTSI2[8][4];
int iBatchNo;

ULONG ulT1, ulT2;
ULONG MsessionAuthen(void);

extern ULONG VW_TypeA_ActiveIdle(BYTE bBaudRate,BYTE *baATQA,BYTE *bSAK,BYTE *bCSN_Length,BYTE *baCSN);
extern ULONG VW_TypeB_PowerOn(BYTE *baPUPI);
extern unsigned int wub_hex_2_str(unsigned char *hex, unsigned char *str, unsigned int len);
extern USHORT EMVPolling(void);

/** Uncomment this line if you want to show debug information in the simulator
 #include <debugprint.h>
 **/
void SelectTTFFont(void) {
    CTOS_LCDSelectMode(4);
    CTOS_LCDTTFSelect(d_FONT_DEFAULT_TTF, 0);
    CTOS_LCDFontSelectMode(d_FONT_TTF_MODE);
    CTOS_LCDTSelectFontSize(d_FONT_16x30);
    //CTOS_LCDTTFASCIIAdjust(14,  0,  0,  0);
}

void UnpackData(BYTE *baSBuf, UINT uiLen, BYTE *baTBuf) {
    UINT i;
    char cMe[3];
    strcpy(baTBuf, "");
    for (i = 0; i < uiLen; i++) {
        sprintf(cMe, "%02X", baSBuf[i]);
        strcat(baTBuf, cMe);
    }
}
//=======================================================================================

void ShowHex(BYTE *baB, ULONG uiL) {
    char caMe[10];
    ULONG i;
    BYTE bKey;

    CTOS_LCDTClearDisplay();
    sprintf(caMe, "[i=%ld]", uiL);
    CTOS_LCDTPrintXY(1, 1, caMe);
    for (i = 0; i < uiL; i++) {
        sprintf(caMe, "%02X ", baB[i]);
        CTOS_LCDTPrintXY((i % 8)*2 + 1, i / 8 + 2, caMe);
    }
    CTOS_KBDGet(&bKey);
    CTOS_LCDTClearDisplay();
}
//------------------------------------------------------------------------

void ShowReverseLine(BYTE x, BYTE y, char *str) {
    CTOS_LCDTSetReverse(d_TRUE);
    CTOS_LCDTPrintXY(x, y, (STR *) str);
    CTOS_LCDTSetReverse(d_FALSE);
}
//------------------------------------------------------------------------

BYTE InputValue(void) {
    int iX, iY;
    BYTE bKey;
	BYTE bAmt_Dec[3] = {0};
	iLen = 0;
	memset(baInput, 0x00, 8);
    
    iX = 1;
    iY = 6;

    while(1){
        CTOS_KBDGet(&bKey);

        switch(bKey){
            case d_KBD_ENTER: //Enter
                if(iLen < 1){
                    CTOS_Delay(100);
                    CTOS_Beep();
                    CTOS_Delay(100);
                    CTOS_Beep();
                }else{
                    if (iLen == 1 && baInput[0] == '0') {
                        CTOS_Delay(100);
                        CTOS_Beep();
                        CTOS_Delay(100);
                        CTOS_Beep();
                        iX--;
                        iLen--;
                    }else{
                        baInput[iLen] = 0;
                        return TRUE;
                    }
                }
                break;
            case d_KBD_CANCEL: //Cancel
            {
                iLen = 1;
                baInput[0] = '0';
                return FALSE;
            }
            case d_KBD_CLEAR: //Clear
                if (iLen == 0) {
                    CTOS_Delay(100);
                    CTOS_Beep();
                    CTOS_Delay(100);
                    CTOS_Beep();
                } else {
                    iX--;
                    iLen--;
					baInput[iLen] = 0x00;
					
					CTOS_LCDTPrintXY(1, 9, "   $          0.00  ");
					if(iLen < 3){
						CTOS_LCDTPrintXY((19 - iLen), 9, baInput);
					}else{
						bAmt_Dec[0] = baInput[iLen-2];
						bAmt_Dec[1] = baInput[iLen-1];
						CTOS_LCDTPrintXY((19 - iLen - 1), 9, baInput);
						CTOS_LCDTPrintXY(16, 9, ".");
						CTOS_LCDTPrintXY(17, 9, bAmt_Dec);
					}
                }
                break;
            default:
                if ((bKey >= '0' && bKey <= '9') && iLen < 7) {
                    iX++;
                    baInput[iLen++] = bKey;
					
					CTOS_LCDTPrintXY(1, 9, "   $          0.00  ");
					
					if(iLen <= 2){
						CTOS_LCDTPrintXY((19 - iLen), 9, baInput);
					}else{
						bAmt_Dec[0] = baInput[iLen-2];
						bAmt_Dec[1] = baInput[iLen-1];
						CTOS_LCDTPrintXY((19 - iLen - 1), 9, baInput);
						CTOS_LCDTPrintXY(16, 9, ".");
						CTOS_LCDTPrintXY(17, 9, bAmt_Dec);
					}
                } else {
                    CTOS_Delay(100);
                    CTOS_Beep();
                    CTOS_Delay(100);
                    CTOS_Beep();
                }
        }
    }

}
//------------------------------------------------------------------------

ULONG ASCII2Int(BYTE *baSBuf, int iL) {
    unsigned long k, iN;
    int i;
    iN = 0;
    k = 1;
    for (i = iL - 1; i >= 0; i--) {
        iN = (unsigned long) ((baSBuf[i] - '0') * k) + iN;
        k *= 10;
    }
    return iN;
}
//------------------------------------------------------------------------

void ShowRtn(ULONG ulRtn, BYTE *baT) {
    STR sBuf[80];
    BYTE bKey;

    CTOS_LCDTPrintXY(1, 1, baT);
    sprintf(sBuf, "Rtn:0x%08lX", ulRtn);
    CTOS_LCDTPrintXY(1, 2, sBuf);
}
//------------------------------------------------------------------------

void PrinterData(BYTE *baValue, UINT uiLen, int iConvert) {
    int iLoop, iTimes, iPos;

    if (iConvert == 1) {
        UnpackData(baValue, uiLen, baMem);
    } else if (iConvert == 2) {
        memcpy(baMem, baValue, uiLen);
        baMem[uiLen] = 0;
    } else if (iConvert == 3) {
        UnpackData(baValue, uiLen, baMem);

        if (baMem[uiLen * 2 - 1] == 'F') {
            baMem[uiLen * 2 - 1] = 0;
        }
    } else if (iConvert == 0) {
        sprintf(baMem, "Date Time: %c%c%c%c/%c%c/%c%c  %c%c:%c%c:%c%c", baValue[0], baValue[1], baValue[2], baValue[3],
                baValue[4], baValue[5], baValue[6], baValue[7], baValue[8], baValue[9], baValue[10], baValue[11], baValue[12], baValue[13]);
    }

    if (iConvert != 0) {
        if (iConvert == 2)
            iTimes = (uiLen / 32) + 1;
        else
            iTimes = (uiLen / 16) + 1;

        iPos = 0;
        for (iLoop = 0; iLoop < iTimes; iLoop++) {
            sprintf(sBuf, "%s", &baMem[iPos]);
            sBuf[32] = 0;
            CTOS_PrinterPutString(sBuf);
            iPos = iPos + 32;
        }
    } else
        CTOS_PrinterPutString(baMem);
    if (iConvert != 1)
        CTOS_PrinterPutString("================================");
}
//------------------------------------------------------------------------

void PrintBlank(void) {
    CTOS_PrinterPutString("\n");
    CTOS_PrinterPutString("\n");
}

//------------------------------------------------------------------------

ULONG MsessionAuthen(void) {
    AUTHKEY_DATA stKeyData;
    BYTE baRN_Reader[9], baTmpRN[17], baOutput[17];
    BYTE baIMEAAuthSK[17], debugbuf[16];

    //CIT_ClearDisplay();
    CTOS_BackLightSet(d_BKLIT_LCD, d_ON);
    //Initialize Communication
    ulAPRtn = VW_InitializeCommunication(d_VW_MEK, 0x01, "\x01\x02\x03\x04\x05\x06\x07\x08", &stKeyData);

    if (ulAPRtn == d_NO_ERROR) {
        //Mutual Authentication
        memcpy(&baRN_Reader, &stKeyData.baRND_R[0], 8);
        //IMEK Authentication SK=3DES[IMEK, RND_R(5:8),RND_B(1:4),RND_R(1:4),RND_B(5:8)]
        memcpy(&baTmpRN[0], &baRN_Reader[4], 4);
        memcpy(&baTmpRN[4], "\x01\x02\x03\x04", 4);
        memcpy(&baTmpRN[8], &baRN_Reader[0], 4);
        memcpy(&baTmpRN[12], "\x05\x06\x07\x08", 4);
        VW_DES(d_ENCRYPTION, 16, "\x00\xBB\xBB\xBB\xBB\xBB\xBB\xBB\x00\x00\x00\x00\x00\x00\x00\x00", baTmpRN, baIMEAAuthSK);
        VW_DES(d_ENCRYPTION, 16, "\x00\xBB\xBB\xBB\xBB\xBB\xBB\xBB\x00\x00\x00\x00\x00\x00\x00\x00", baTmpRN + 8, baIMEAAuthSK + 8);

        //crypto2=3DES[AuthSK, RN_B(5:8),RN_R(1:4),RN_B(1:4),RND_R(5:8)]
        memcpy(&baTmpRN[0], "\x05\x06\x07\x08", 4);
        memcpy(&baTmpRN[4], &baRN_Reader[0], 4);
        memcpy(&baTmpRN[8], "\x01\x02\x03\x04", 4);
        memcpy(&baTmpRN[12], &baRN_Reader[4], 4);
        VW_DES(d_ENCRYPTION, 16, baIMEAAuthSK, baTmpRN, baOutput);
        VW_DES(d_ENCRYPTION, 16, baIMEAAuthSK, baTmpRN + 8, baOutput + 8);

        stKeyData.bKeyType = d_VW_MEK;
        stKeyData.bKeyIndex = 0x01;
        memcpy(stKeyData.baEnRND, baOutput, 16);
        ulAPRtn = VW_MutualAuthenticate(&stKeyData);

        if (ulAPRtn == d_NO_ERROR) {
            //Generate Keys
            stKeyData.bKeyType = d_VW_Msession;
            stKeyData.bKeyIndex = 0x01;
            memcpy(&baTmpRN[0], "\x22\x22\x22\x22\x22\x22\x22\x22\x33\x33\x33\x33\x33\x33\x33\x33", 16);
            VW_DES(d_ENCRYPTION, 16, baIMEAAuthSK, baTmpRN, baOutput);
            VW_DES(d_ENCRYPTION, 16, baIMEAAuthSK, baTmpRN + 8, baOutput + 8);
            memcpy(stKeyData.baEnRND, baOutput, 16);
            ulAPRtn = VW_GenerateKeys(&stKeyData);
            if (ulAPRtn != d_NO_ERROR)
                return ulAPRtn;
            else {
                ulAPRtn = VW_SetSessionKey(d_MsessionFlag, "\x22\x22\x22\x22\x22\x22\x22\x22\x33\x33\x33\x33\x33\x33\x33\x33");
                if (ulAPRtn != d_NO_ERROR)
                    return ulAPRtn;
            }
        } else
            return ulAPRtn;
    } else
        return ulAPRtn;

    return ulAPRtn;
}
//------------------------------------------------------------------------

void ShowTagsInfo(USHORT tag, USHORT len, BYTE *buf) {
    int iLoop;

    if (tag == 0x5A) {
        sprintf(sBuf, "[PAN %02X]", tag);
        CTOS_PrinterPutString(sBuf);
    } else if (tag == 0x55) {
        sprintf(sBuf, "[CVM Signature %02X]", tag);
        CTOS_PrinterPutString(sBuf);
    } else if (tag == 0x9B) {
        sprintf(sBuf, "[TSI %02X]", tag);
        CTOS_PrinterPutString(sBuf);
    } else if (tag == 0x9F66) {
        sprintf(sBuf, "[TTQ %04X]", tag);
        CTOS_PrinterPutString(sBuf);
    } else if (tag == 0x9F02) {
        sprintf(sBuf, "[Amount, Authorized %04X]", tag);
        CTOS_PrinterPutString(sBuf);
    } else if (tag == 0x9F03) {
        sprintf(sBuf, "[Amount, Other %04X]", tag);
        CTOS_PrinterPutString(sBuf);
    } else if (tag == 0x9F1A) {
        sprintf(sBuf, "[Terminal Country Code %04X]", tag);
        CTOS_PrinterPutString(sBuf);
    } else if (tag == 0x95) {
        sprintf(sBuf, "[TVR %02X]", tag);
        CTOS_PrinterPutString(sBuf);
    } else if (tag == 0x5F20) {
        sprintf(sBuf, "[Cardholder Name %04X]", tag);
        CTOS_PrinterPutString(sBuf);
    } else if (tag == 0x5F2A) {
        sprintf(sBuf, "[Transaction Currency Code %04X]", tag);
        CTOS_PrinterPutString(sBuf);
    } else if (tag == 0x5F34) {
        sprintf(sBuf, "[PAN Sequence Num. %04X]", tag);
        CTOS_PrinterPutString(sBuf);
    } else if (tag == 0x9A) {
        sprintf(sBuf, "[Transaction Date %02X]", tag);
        CTOS_PrinterPutString(sBuf);
    } else if (tag == 0x9C) {
        sprintf(sBuf, "[Transaction Type %02X]", tag);
        CTOS_PrinterPutString(sBuf);
    } else if (tag == 0x9F37) {
        sprintf(sBuf, "[Unpredictable Number %04X]", tag);
        CTOS_PrinterPutString(sBuf);
    } else if (tag == 0x82) {
        sprintf(sBuf, "[AIP %02X]", tag);
        CTOS_PrinterPutString(sBuf);
    } else if (tag == 0x9F36) {
        sprintf(sBuf, "[ATC %04X]", tag);
        CTOS_PrinterPutString(sBuf);
    } else if (tag == 0x9F26) {
        sprintf(sBuf, "[AC %04X]", tag);
        CTOS_PrinterPutString(sBuf);
    } else if (tag == 0x9F27) {
        sprintf(sBuf, "[CID %04X]", tag);
        CTOS_PrinterPutString(sBuf);
    } else if (tag == 0x9F10) {
        sprintf(sBuf, "[IAD %04X]", tag);
        CTOS_PrinterPutString(sBuf);
    } else if (tag == 0x9F74) {
        sprintf(sBuf, "[VLP IAD %04X]", tag);
        CTOS_PrinterPutString(sBuf);
    } else if (tag == 0xDFCF) {
        sprintf(sBuf, "[Transaction Result %04X]", tag);
        CTOS_PrinterPutString(sBuf);
    } else if (tag == 0xDFCB) {
        sprintf(sBuf, "[CVM Result %04X]", tag);
        CTOS_PrinterPutString(sBuf);
    } else {
        sprintf(sBuf, "[Unknown %04X]", tag);
        CTOS_PrinterPutString(sBuf);
    }

    UnpackData(buf, len, baTmp);
    for (iLoop = 0; iLoop < (len / 16 + 1); iLoop++) {
        sprintf(sBuf, "%s", baTmp + iLoop * 32);
        sBuf[32] = 0;
        CTOS_PrinterPutString(sBuf);
    }
}
//------------------------------------------------------------------------
static const BYTE baPrinterBufferLogo_Receipt2[] = {
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x80, 0xC0, 0xC0, 0xE0, 0xE0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF8,
    0xF8, 0xF8, 0xF8, 0xF8, 0xF8, 0x78, 0x78, 0x7C, 0x78, 0x78, 0xF8, 0xF8, 0xF8, 0xF8, 0xF8, 0xF8,
    0xF8, 0xF0, 0xF0, 0xF0, 0xE0, 0xE0, 0xC0, 0xC0, 0x80, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0xE0, 0xF8, 0xFE, 0xFF, 0xFF, 0xFC, 0xF8,
    0xE0, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x80, 0x80, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0x80, 0x80,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x80, 0x80, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0,
    0x80, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xC0, 0xC0, 0xC0,
    0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0,
    0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x80, 0x80,
    0x80, 0x80, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0,
    0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0,
    0xC0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x80, 0xC0,
    0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0x80, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0xC0, 0xE0, 0xF0, 0xF8,
    0xF8, 0xFC, 0x7E, 0x3F, 0x1F, 0x1F, 0x0F, 0x07, 0x07, 0x87, 0x83, 0xC3, 0xC1, 0xE1, 0xE1, 0xE0,
    0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF8, 0xF8, 0xF8, 0xF8, 0xF8, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xE0,
    0xE0, 0xE1, 0xC1, 0xC1, 0x83, 0x83, 0x07, 0x07, 0x0F, 0x1F, 0x1F, 0x3F, 0x7E, 0xFC, 0xFC, 0xF8,
    0xF0, 0xE0, 0xC0, 0x80, 0x80, 0xE0, 0xF8, 0xFE, 0xFF, 0xFF, 0x3F, 0x0F, 0x07, 0x03, 0x07, 0x1F,
    0x3F, 0xFF, 0xFF, 0xFC, 0xF0, 0xC0, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0xE0, 0xF8, 0xFC,
    0xFE, 0xFF, 0xFF, 0x7F, 0x3F, 0x1F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x1F, 0x3F, 0x7F, 0xFF,
    0xFF, 0xFF, 0xFE, 0xFC, 0xF0, 0xC0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0xE0, 0xFC, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xF8,
    0xC0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xC0,
    0xF8, 0xFE, 0xFF, 0xFF, 0xFF, 0xFF, 0x1F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x1F, 0x3F,
    0xFF, 0xFF, 0xFF, 0xFF, 0xFE, 0xF8, 0xE0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0F, 0x0F, 0x0F,
    0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x0F, 0x0F, 0x0F,
    0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F,
    0x0F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF8, 0xFC, 0xFE, 0xFF, 0xFF, 0xFF, 0x1F,
    0x1F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x1F, 0x3F, 0xFF, 0xFF, 0xFF, 0xFF, 0xFE, 0xF8, 0xE0,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xC0, 0xE0, 0xF8, 0xFC, 0xFF, 0x7F, 0x3F, 0x0F, 0x07, 0x03,
    0x01, 0xC0, 0xE0, 0xF0, 0xF8, 0xFC, 0xFE, 0x7E, 0x3F, 0x1F, 0x0F, 0x0F, 0x07, 0x07, 0x03, 0x83,
    0x83, 0xC1, 0xC1, 0xC1, 0xC1, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE1, 0xC1, 0xC1, 0xC1, 0x81, 0x83,
    0x03, 0x07, 0x07, 0x07, 0x0F, 0x1F, 0x3F, 0x7F, 0xFE, 0xFC, 0xF8, 0xF0, 0xE0, 0xC0, 0x81, 0x03,
    0xC7, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x3F, 0x0F, 0x03, 0x00, 0x80, 0xE0, 0xF0, 0xF8, 0xE0, 0xC0,
    0x00, 0x00, 0x03, 0x07, 0x1F, 0x7F, 0xFF, 0xFE, 0xFC, 0xF0, 0xC0, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFC, 0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01,
    0x03, 0x03, 0x01, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0xC0, 0xF8, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x1F, 0x01, 0x00, 0x07, 0x3F, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFE, 0xF0, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03,
    0x1F, 0x3F, 0x7F, 0xFF, 0xFF, 0xFF, 0xFE, 0xFC, 0xF8, 0xF8, 0xF8, 0xF8, 0xF0, 0xF0, 0xF0, 0xE0,
    0xE1, 0xC1, 0xC1, 0x81, 0x01, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0F, 0x3F, 0x7F, 0xFF, 0xFF, 0xFF, 0xFE,
    0xFC, 0xF8, 0xF8, 0xF8, 0xF8, 0xF0, 0xF0, 0xF0, 0xE0, 0xE0, 0xE1, 0xC1, 0x81, 0x81, 0x01, 0x01,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0xC0, 0xF8, 0xFE, 0xFF, 0xFF, 0x3F, 0x07, 0x01, 0x00, 0x00, 0xE0, 0xF8, 0xFE,
    0xFF, 0xFF, 0x3F, 0x0F, 0x03, 0x01, 0x00, 0x80, 0xE0, 0xF0, 0xF8, 0xFC, 0xFE, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0x7F, 0x3F, 0x3F, 0x3F, 0x3F, 0x3F, 0x7F, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFE, 0xFE, 0xFC, 0xF8, 0xE0, 0xC0, 0x00, 0x01, 0x03, 0x0F, 0xDF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0x1F, 0x0F, 0x03, 0x00, 0x80, 0xE0, 0xF8, 0xFC, 0xFF, 0xFF, 0x3F, 0x1F, 0x7F, 0xFF,
    0xFF, 0xFC, 0xF0, 0xE0, 0x80, 0x00, 0x01, 0x03, 0x0F, 0x1F, 0x7F, 0xFF, 0xFE, 0xF8, 0xE0, 0xC0,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7F, 0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80,
    0xE0, 0xC0, 0xC0, 0xC0, 0x80, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0xF0,
    0xFE, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xF7, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF1, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFF, 0xFC, 0xE0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0xC0,
    0xC0, 0xC0, 0xC0, 0xC0, 0xC1, 0x01, 0x03, 0x03, 0x03, 0x07, 0x07, 0x07, 0x0F, 0x0F, 0x0F, 0x1F,
    0x1F, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFC, 0xE0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x03,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC1, 0x01, 0x03,
    0x03, 0x03, 0x07, 0x07, 0x07, 0x0F, 0x0F, 0x0F, 0x1F, 0x1F, 0x7F, 0xFF, 0xFF, 0xFF, 0xFF, 0xFC,
    0xF0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0xFC, 0xFF, 0xFF, 0xFF, 0xFF, 0x03, 0x00, 0x00, 0x00, 0xF0, 0xFF, 0xFF, 0xFF, 0xFF,
    0x0F, 0x00, 0x00, 0x00, 0x00, 0xF8, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    0xC1, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0xC1, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFC, 0xFE, 0xFF, 0xFF, 0x7F, 0x1F, 0x07,
    0x01, 0x00, 0x80, 0xE0, 0xF8, 0xFE, 0xFF, 0x7F, 0x3F, 0x0F, 0x03, 0x00, 0x80, 0x80, 0x00, 0x00,
    0x03, 0x07, 0x1F, 0x7F, 0xFF, 0xFE, 0xFC, 0xF0, 0xC0, 0x80, 0x00, 0x01, 0x07, 0x1F, 0x3F, 0xFF,
    0xFF, 0xFC, 0xF0, 0xE0, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x0F, 0x3F, 0x7F,
    0xFF, 0xFF, 0xFF, 0xFC, 0xF8, 0xF0, 0xF0, 0xE0, 0xE0, 0xE0, 0xE0, 0xF0, 0xF0, 0xF8, 0xFE, 0xFF,
    0xFF, 0xFF, 0x7F, 0x3F, 0x0F, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xE0, 0xFC, 0xFF, 0xFF,
    0xFF, 0xFF, 0x7F, 0x0F, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03,
    0x03, 0x1F, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xF8, 0xC0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0F,
    0x3F, 0x7F, 0xFF, 0xFF, 0xFF, 0xFE, 0xF8, 0xF0, 0xF0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xF0, 0xF0,
    0xF8, 0xFF, 0xFF, 0xFF, 0xFF, 0x7F, 0x1F, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0,
    0xF0, 0xF0, 0xF0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0,
    0xF0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0x3F, 0x7F, 0xFF, 0xFF, 0xFF, 0xFE, 0xFC,
    0xF0, 0xF0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xF0, 0xF0, 0xF8, 0xFE, 0xFF, 0xFF, 0xFF, 0x7F, 0x1F,
    0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x3F, 0xFF, 0xFF, 0xFF, 0xFF, 0xC0, 0x00, 0x00, 0x00, 0x0F, 0xFF, 0xFF, 0xFF, 0xFF,
    0xE0, 0x00, 0x00, 0x00, 0x00, 0x1F, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFE, 0xFE, 0xFE, 0xFE, 0xFE, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x7F, 0x1F, 0x07, 0x01, 0x00, 0x80, 0xE0,
    0xF8, 0xFE, 0xFF, 0x7F, 0x1F, 0x07, 0x03, 0x00, 0x00, 0xE0, 0xF8, 0xFE, 0xFF, 0xFF, 0xFE, 0xF8,
    0xF0, 0xC0, 0x00, 0x00, 0x00, 0x03, 0x0F, 0x3F, 0x7F, 0xFF, 0xFE, 0xF8, 0xF0, 0xC0, 0x00, 0x00,
    0x03, 0x07, 0x1F, 0x7F, 0xFF, 0xFE, 0xFC, 0xF0, 0xC0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x01, 0x01, 0x03, 0x03, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x03, 0x03, 0x03,
    0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x03, 0x03, 0x03, 0x03,
    0x03, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x01, 0x03, 0x03, 0x03, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07,
    0x03, 0x03, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x03, 0x03,
    0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03,
    0x03, 0x03, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03,
    0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03,
    0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x03, 0x03, 0x03,
    0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x03, 0x03, 0x03, 0x01, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x03, 0x1F, 0xFF, 0xFF, 0xFF, 0xFC, 0xE0, 0x80, 0x00, 0x00, 0x07, 0x1F, 0x7F,
    0xFF, 0xFF, 0xF8, 0xF0, 0xC0, 0x80, 0x00, 0x03, 0x07, 0x1F, 0x3F, 0x3F, 0x7F, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0x7F, 0x3F, 0x1F, 0x0F, 0x03, 0x00, 0x00, 0xC0, 0xE0, 0xF8, 0xFE, 0xFF, 0x3F,
    0x1F, 0x07, 0x01, 0x00, 0x00, 0xC0, 0xF0, 0xFE, 0xFF, 0xFF, 0x3F, 0x0F, 0x03, 0x01, 0x07, 0x0F,
    0x3F, 0x7F, 0xFF, 0xFE, 0xF8, 0xE0, 0xC0, 0x00, 0x00, 0x01, 0x07, 0x0F, 0x3F, 0xFF, 0xFF, 0xFE,
    0xF8, 0xE0, 0x80, 0x00, 0x00, 0x03, 0x0F, 0x1F, 0x7F, 0xFF, 0xFE, 0xF8, 0xF0, 0xC0, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xE0, 0xF0, 0xF0, 0xF0, 0xF0,
    0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0x00, 0x00, 0x00, 0x00,
    0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xE0,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0xC0, 0xE0, 0xE0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0,
    0xF0, 0xE0, 0xE0, 0xC0, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF0, 0xF0, 0xF0, 0xF0, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF0, 0xF0, 0xF0, 0xF0, 0xE0, 0x00, 0x00, 0x00, 0x00,
    0x00, 0xE0, 0xF0, 0xF0, 0xF0, 0xF0, 0xC0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF0, 0xF0,
    0xF0, 0xF0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0xC0, 0xE0, 0xE0, 0xF0, 0xF0, 0xF0,
    0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xE0, 0xC0, 0xC0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0xF0, 0xF0, 0xF0, 0xE0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x80, 0xC0, 0xE0, 0xE0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xE0,
    0xE0, 0xC0, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0xC0, 0xE0, 0xE0,
    0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xE0, 0xE0, 0xC0, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x70, 0xF0, 0xF0, 0xF0, 0xE0, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xC0, 0xF0, 0xF0,
    0xF0, 0xF0, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x0F, 0x1F, 0x7F, 0xFF, 0xFE, 0xFC, 0xF0, 0xE0, 0xC0,
    0x80, 0x03, 0x07, 0x0F, 0x1F, 0x3F, 0x3F, 0x7E, 0xFC, 0xF8, 0xF0, 0xF0, 0xE0, 0xE0, 0xC1, 0xC1,
    0x83, 0x83, 0x83, 0x83, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x83, 0x83, 0x83, 0xC1,
    0xC1, 0xC0, 0xE0, 0xE0, 0xF0, 0xF8, 0xF8, 0x7C, 0x7E, 0x3F, 0x1F, 0x0F, 0x03, 0x01, 0x00, 0xC0,
    0xE0, 0xF0, 0xF8, 0xFE, 0xFF, 0x7F, 0x3F, 0x0F, 0x03, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x01, 0x07, 0x0F, 0x3F, 0xFF, 0xFF, 0xFC, 0xF8, 0xE0, 0xC0, 0x00, 0x00, 0x03, 0x07,
    0x1F, 0x7F, 0xFF, 0xFF, 0xFC, 0xF0, 0xE0, 0x80, 0x00, 0x01, 0x03, 0x0F, 0x3F, 0xFF, 0xFF, 0xFC,
    0xF8, 0xE0, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0xFF, 0xFF, 0xFF, 0xFF, 0xE1, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xC0, 0x00,
    0x00, 0x00, 0x00, 0x00, 0xF8, 0xFE, 0xFF, 0xFF, 0xFF, 0x03, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00,
    0x01, 0x07, 0x0F, 0x07, 0x07, 0x06, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0xE0,
    0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00,
    0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0x1F, 0x7F, 0xFF, 0xFC, 0xF0, 0xC0, 0x00, 0x00, 0x00, 0xFF, 0xFF,
    0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFC, 0xFF, 0xFF, 0xFF, 0x0F, 0x03, 0x01, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x01, 0x03, 0x07, 0xFF, 0xFF, 0xFF, 0xFC, 0xE0, 0x00, 0x00, 0x00, 0x00, 0x00,
    0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0xFC, 0xFF, 0xFF, 0xFF, 0x0F, 0x03, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x03,
    0x07, 0xFF, 0xFF, 0xFF, 0xFC, 0xE0, 0x00, 0x00, 0x00, 0x80, 0xFC, 0xFF, 0xFF, 0xFF, 0x0F, 0x03,
    0x01, 0x00, 0x00, 0x00, 0x80, 0x80, 0x81, 0x83, 0x87, 0x87, 0x87, 0x87, 0x80, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x01, 0x03, 0x1F, 0x3F, 0xFF, 0xFE, 0xF8, 0xE0, 0xF0, 0xFC, 0xFF, 0x7F, 0x1F, 0x07,
    0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x03, 0x07, 0x0F, 0x1F,
    0x3F, 0x7F, 0x7E, 0xFC, 0xF8, 0xF8, 0xF0, 0xE0, 0xE0, 0xC1, 0xC1, 0x83, 0x83, 0x87, 0x07, 0x07,
    0x0F, 0x0F, 0x0F, 0x0F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x0F, 0x0F, 0x0F, 0x0F,
    0x07, 0x87, 0x83, 0x83, 0xC3, 0xC1, 0xE0, 0xE0, 0xF0, 0xF0, 0xF8, 0xFC, 0x7E, 0x7E, 0x3F, 0x1F,
    0x0F, 0x07, 0x03, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x07, 0x0F, 0x3F, 0xFF, 0xFF, 0xFC, 0xF0, 0xE0,
    0x80, 0x00, 0x00, 0x03, 0x07, 0x1F, 0x7F, 0xFF, 0xFE, 0xFC, 0xF0, 0xC0, 0x80, 0x00, 0x01, 0x07,
    0x1F, 0x3F, 0xFF, 0xFE, 0xFC, 0xF0, 0xE0, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0xFF, 0xFF, 0xFF, 0xFF, 0x83, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x01, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x1F, 0x7F, 0xFF, 0xFF, 0xFF, 0xC0, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x80, 0xE0, 0xF8, 0xF0, 0xF0, 0x30, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0x03,
    0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00,
    0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x01, 0x07, 0x0F, 0x7F, 0xFF, 0xFE, 0xFC, 0xFF, 0xFF,
    0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1F, 0xFF, 0xFF, 0xFF, 0xF0, 0xC0, 0x80, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x80, 0xC0, 0xE0, 0xFF, 0xFF, 0xFF, 0x3F, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00,
    0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x3F, 0xFF, 0xFF, 0xFF, 0xF0, 0xC0, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0xC0,
    0xE0, 0xFF, 0xFF, 0xFF, 0x3F, 0x07, 0x00, 0x00, 0x00, 0x01, 0x3F, 0xFF, 0xFF, 0xFF, 0xF0, 0xC0,
    0x80, 0x00, 0x00, 0x00, 0x07, 0x07, 0x87, 0x87, 0xC7, 0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x01, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x01, 0x01, 0x03, 0x03, 0x03, 0x07, 0x07, 0x0F, 0x0F, 0x0F, 0x1F, 0x1F,
    0x1F, 0x1F, 0x3E, 0x3E, 0x3E, 0x3E, 0x3E, 0x3E, 0x3E, 0x3E, 0x3E, 0x3E, 0x3E, 0x1F, 0x1F, 0x1F,
    0x1F, 0x0F, 0x0F, 0x0F, 0x07, 0x07, 0x07, 0x03, 0x03, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x07, 0x07, 0x07,
    0x07, 0x06, 0x04, 0x00, 0x00, 0x00, 0x00, 0x01, 0x03, 0x07, 0x07, 0x07, 0x07, 0x06, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x03, 0x07, 0x07, 0x07, 0x07, 0x06, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x0F, 0x0F, 0x0F, 0x0F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x03, 0x07, 0x07, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F,
    0x0F, 0x07, 0x07, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0F, 0x0F, 0x0F, 0x0F, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x0F, 0x0F, 0x0F, 0x0F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x0F, 0x0F, 0x0F,
    0x0F, 0x0F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x03, 0x07, 0x07, 0x0F, 0x0F, 0x0F,
    0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x07, 0x03, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x01, 0x03, 0x07, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F,
    0x07, 0x03, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x03, 0x07, 0x07,
    0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x07, 0x07, 0x03, 0x03, 0x01, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

};


void Print_Receipt2(RC_DATA *data, ULONG ulValue){//EMVCL_RC_DATA_EX
	BYTE baTemp[384 * 64]; // The width of paper is 384 dot.

    //Font atrributes
    CTOS_FONT_ATTRIB stFONT_ATTRIB;

    //Auxiliar char buffer
    UCHAR charBuffer[50];

    // Auxiliar PAN number
    UCHAR applicationAIDAux[40];

    // Auxiliar PAN number
    UCHAR PANNumberAux[40];

    // Lenght of PAN number
    BYTE lenghtPANNumber;

    BYTE Timer_printSTR[40] = {0};
	
	CTOS_RTC stRTC;

    CTOS_PrinterFline(5);
	
	//Print out the bank logo
    CTOS_PrinterLogo((BYTE *) baPrinterBufferLogo_Receipt2, 0, 380, 10);
    CTOS_PrinterFline(12);

    stFONT_ATTRIB.X_Space = 0;
    //The height of the space between the font with next font
    stFONT_ATTRIB.Y_Space = 0;
    memset(baTemp, 0x00, sizeof (baTemp));
    stFONT_ATTRIB.FontSize = d_FONT_8x16;
    //Double de X size
    stFONT_ATTRIB.X_Zoom = 3;
    //Double de Y size
    stFONT_ATTRIB.Y_Zoom = 4;
    //The width of the space between the font with next font
    CTOS_PrinterBufferPutString((BYTE *) baTemp, 0, 0, (BYTE *) "VEGA3000", &stFONT_ATTRIB);
    CTOS_PrinterBufferOutput((BYTE *) baTemp, 6);
    CTOS_PrinterFline(20);
	
    //==============================
    //Print out the transaction data
    //==============================
    CTOS_PrinterPutString((BYTE *) "MER ID: 886289131771");
    CTOS_PrinterFline(5);
    strcpy((char *) applicationAIDAux, "BATCH NO: 000307");
    CTOS_PrinterPutString(applicationAIDAux);
    CTOS_PrinterFline(5);


	//Card Number
	UnpackData(data->baTrack2Data, 20, baTmp);
	memcpy(baTemp, baTmp, 4);
	memcpy(baTemp2, &baTmp[12], 4);
	baTemp2[16] = 0;

	
    
    stFONT_ATTRIB.FontSize = d_FONT_8x16;
    stFONT_ATTRIB.X_Zoom = 2;
    stFONT_ATTRIB.Y_Zoom = 2;

    CTOS_PrinterPutString((unsigned char *) "CARD NO:");
    CTOS_PrinterFline(12);

    lenghtPANNumber = strlen("  ********************");
	sprintf(PANNumberAux, "  %s **** **** %s", baTemp, baTemp2);
    //strcpy((char *) PANNumberAux, "  ********************");
	
	memset(baTemp, 0x00, sizeof (baTemp));
    CTOS_PrinterBufferPutString((BYTE *) baTemp, 0, 0, PANNumberAux, &stFONT_ATTRIB);
    CTOS_PrinterBufferOutput((BYTE *) baTemp, 8);
	
	//Exp Date
	memcpy(baTemp, baTmp + 19, 2);
	baTemp[2] = 0;
	memcpy(baTmp1, baTmp + 17, 2);
	baTmp1[2] = 0;

	
	sprintf(baBuf, "EXP. DATE: 20%s/%s", baTmp1, baTemp);
    CTOS_PrinterPutString(baBuf);
    CTOS_PrinterFline(5);
    CTOS_PrinterPutString((BYTE *) "ISSUER: 84188062");
    CTOS_PrinterFline(15);
	
	memset(baTemp, 0x00, sizeof (baTemp));
    stFONT_ATTRIB.FontSize = d_FONT_8x16;
    stFONT_ATTRIB.X_Zoom = 3;
    stFONT_ATTRIB.Y_Zoom = 2;
    CTOS_PrinterBufferPutString((BYTE *) baTemp, 0, 0, (BYTE *) "       BOOK/SALE", &stFONT_ATTRIB);
    CTOS_PrinterBufferOutput((BYTE *) baTemp, 6);
    CTOS_PrinterFline(12);

    CTOS_PrinterPutString((BYTE *) "TERM ID: 11010001   OPER ID: 002");
    CTOS_PrinterFline(5);
    CTOS_RTCGet(&stRTC);
    sprintf((char *) Timer_printSTR, "DATE:%02d/%02d/20%02d    TIME:%02d:%02d", stRTC.bDay, stRTC.bMonth, stRTC.bYear, stRTC.bHour, stRTC.bMinute);
    CTOS_PrinterPutString((BYTE *) Timer_printSTR);
    //CTOS_PrinterPutString((BYTE *)"DATE: 31/10/2012    TIME: 14:52");
    CTOS_PrinterFline(5);
    CTOS_PrinterPutString((BYTE *) "REF NO: 855090913452");
    CTOS_PrinterFline(15);

	
	int i, j;
	i = (int)ulValue / 100;
	j = (int)ulValue % 100;
	if(i == 0)
		sprintf((char *) charBuffer, "      $ 0.%02d", j);
	else
		sprintf((char *) charBuffer, "      $ %d.%02d", i, j);
	
    stFONT_ATTRIB.FontSize = d_FONT_8x16;
    stFONT_ATTRIB.X_Zoom = 3;
    stFONT_ATTRIB.Y_Zoom = 4;
    memset(baTemp, 0x00, sizeof (baTemp));
    CTOS_PrinterBufferPutString((BYTE *) baTemp, 0, 0, (BYTE *) charBuffer, &stFONT_ATTRIB);
    CTOS_PrinterBufferOutput((BYTE *) baTemp, 6);

    CTOS_PrinterFline(40);
    CTOS_PrinterPutString((BYTE *) "===== CARDHOLDER SIGNATURE =====");
    CTOS_PrinterFline(40);

    CTOS_PrinterPutString((BYTE *) "\n\n");
}


void StartTrans(void) {
    ULONG ulValue;
    USHORT  len;
    ULONG tag;
    int n;
    BYTE bStatus, bKey, buf[16], debugbuf[32];

    memset(buf, 0x00, sizeof (buf));


    CTOS_BackLightSet(d_BKLIT_LCD, d_ON);

    ulValue = ASCII2Int(baInput, iLen);
    ulAPRtn = VW_StartTransaction(ulValue, &stRCData);

    if (ulAPRtn == 0xA0000001) {

        //Check Transaction Result
        usTxResult = 0;
        memset(debugbuf, 0x00, sizeof (buf));
        sprintf(debugbuf, "DataLen=%d\n", stRCData.bAdditionalDataLen);
        printf(debugbuf);
        
        if (stRCData.bAdditionalDataLen) {
            n = 0;
            while (n < stRCData.bAdditionalDataLen) {
                //Tag
                if ((stRCData.baAdditionalData[n] & 0x1F) == 0x1F)//2 bytes tag
                {
                    if((stRCData.baAdditionalData[n+1] & 0x80)==0x80 )
                    {
                        tag = stRCData.baAdditionalData[n] * 256 * 256 + stRCData.baAdditionalData[n + 1] * 256 + stRCData.baAdditionalData[n + 2];
                         n += 3;
                    
                    }else{
                        
                        tag = stRCData.baAdditionalData[n] * 256 + stRCData.baAdditionalData[n + 1];
                        n += 2;
                    }
                    
                } else {
                    tag = stRCData.baAdditionalData[n];
                    n++;
                }

                //Length
                if ((stRCData.baAdditionalData[n] & 0x81) == 0x81) //2 bytes length
                {
                    len = stRCData.baAdditionalData[n + 1];
                    n += 2;
                } else {
                    len = stRCData.baAdditionalData[n];
                    n++;
                }

                if (tag == 0xDF8F4F) {
                    usTxResult = stRCData.baAdditionalData[n] * 256 + stRCData.baAdditionalData[n + 1];
                    break;
                }
                n += len;
            }
        }
        memset(debugbuf, 0x00, sizeof (buf));
        sprintf(debugbuf, "usTxResult=0x%08X\n", usTxResult);
        printf(debugbuf);

        if (usTxResult == d_EMV_PAYPASS_MSD_ONLINE || usTxResult == d_EMV_CHIP_ONL || usTxResult == d_EMV_VISA_MSD_ONLINE) {

            ulAPRtn = VW_ShowStatus("\x00\x02\x04\x02", 4);
            if (ulAPRtn != d_NO_ERROR)
                ShowRtn(ulAPRtn, "ShowStatus");

        } else if (usTxResult == d_EMV_CHIP_OFF_APPROVAL) {

            ulAPRtn = VW_ShowStatus("\x00\x02\x04\x02", 4);
            if (ulAPRtn != d_NO_ERROR)
                ShowRtn(ulAPRtn, "ShowStatus");
        } else if (usTxResult == d_EMV_CHIP_OFF_DECLINED) {
            CTOS_LCDTClearDisplay();
            ShowReverseLine(1, 3, "Offline Decline");
            ulAPRtn = VW_ShowStatus("\x01\x01\x05", 3);
            if (ulAPRtn != d_NO_ERROR)
                ShowRtn(ulAPRtn, "ShowStatus");
        } else {
            sprintf(buf, "0x%08X", usTxResult);
            ShowReverseLine(1, 2, buf);
            ShowReverseLine(1, 3, "Undefined error");
            CTOS_KBDGet(&bKey);
            return;

        }
		CTOS_LCDGShowBMPPic(0, 0, "Printing.bmp");
		Print_Receipt2(&stRCData, ulValue);
		
    } else {
        CTOS_LCDTClearDisplay();
        if (ulAPRtn == 0xA00000FB)
            CTOS_LCDTPrintXY(1, 4, "Auth Not Perform");
        ShowRtn(ulAPRtn, "StartTransaction");
    }

    return;
}

//------------------------------------------------------------------------------
void write_online_key(void)
{
  USHORT usRet;
  CTOS_KMS2KEYWRITE_PARA stKeyWritePara;
  
  memset(&stKeyWritePara, 0x00, sizeof(CTOS_KMS2KEYWRITE_PARA));
  
  stKeyWritePara.Info.KeySet = d_ONLINE_KEYSET;
  //stKeyWritePara.Info.KeySet = 0x1001;
  stKeyWritePara.Info.KeyIndex = d_ONLINE_KEYINDEX;
  stKeyWritePara.Info.KeyVersion = 0x01;
  stKeyWritePara.Info.KeyType = KMS2_KEYTYPE_3DES;
  stKeyWritePara.Info.KeyAttribute = KMS2_KEYATTRIBUTE_PIN;
  
  stKeyWritePara.Protection.Mode = KMS2_KEYPROTECTIONMODE_PLAINTEXT;
  //stKeyWritePara.Protection.Mode = KMS2_KEYPROTECTIONMODE_KPK_ECB;
  //stKeyWritePara.Verification.KeyCheckValueLength = 4;
  //stKeyWritePara.Verification.pKeyCheckValue = check_value;
  
  stKeyWritePara.Value.KeyLength = 16;
  stKeyWritePara.Value.pKeyData = d_ONLINE_KEY;
      
  usRet = CTOS_KMS2KeyWrite(&stKeyWritePara);
  printf("write_online_key usRet = %x\n",usRet);
  
  stKeyWritePara.Info.KeyIndex = d_OFFLINE_KEYINDEX;
  stKeyWritePara.Info.KeyAttribute = KMS2_KEYATTRIBUTE_ENCRYPT+KMS2_KEYATTRIBUTE_DECRYPT;
  
  usRet = CTOS_KMS2KeyWrite(&stKeyWritePara);
}

void OnDisplayShow(IN char *pStrMsg)  //add '\n' break line
{
//printf("OnDisplayShow 1\n");
    //CTOS_LCDTPrintXY(1, 3, pStrMsg);
//printf("OnDisplayShow 2\n");
}

void OnErrorMsg(IN char *pStrMsg)
{
//printf("OnErrorMsg 1\n");
    CTOS_LCDTPrintXY(1, 6, pStrMsg);
//printf("OnErrorMsg 2\n");
}

// This function will be called during EMV_Initialize;
void OnEMVConfigActive(INOUT BYTE* pActiveIndex)
{
	
}

USHORT OnTxnDataGet(OUT EMV_TXNDATA *pTxnData)
{
//printf("OnTxnDataGet 1\n");
    pTxnData->Version = 1;
    pTxnData->ulAmount = g_ulAMT;
//printf("OnTxnDataGet 2\n");    
    return d_OK;
}

#define d_FONTSIZE 16

BYTE ShowAPList(BYTE start_y, BYTE max_y, BYTE *sHeaderString, BYTE iHeaderStrLen, BYTE apnum, char aplist[][17], BYTE *selitem)
{
	BYTE str[20], i, curr_top, curr_off, c;
	BYTE hx = 1, hy = 1;
	BYTE baHeader[17];

	CTOS_LCDTClearDisplay();

	//Show [AP List]
	if (iHeaderStrLen <= d_FONTSIZE) {
		//by Center
		hx = ((d_FONTSIZE - iHeaderStrLen) / 2) + 1;
		memset(baHeader, 0x20, sizeof (baHeader));
		memcpy(&baHeader[hx - 1], sHeaderString, iHeaderStrLen);
		CTOS_LCDTPrintXY(1, 1, baHeader);
	}
        
	curr_top = 0;
	curr_off = 0; //Offset from curr_top

	while (1) {
		for (i = start_y; i <= max_y; i++)
			CTOS_LCDTPrintXY(1, i, (BYTE*)"                ");

		for (i = 0; i < max_y - start_y + 1; i++) {
			if (curr_top + i >= apnum)
				break;

			if (i == curr_off)
				CTOS_LCDTSetReverse(TRUE);

			CTOS_LCDTPrintXY(1, start_y + i, (BYTE*)aplist[curr_top + i]);

			if (i == curr_off)
				CTOS_LCDTSetReverse(FALSE);
		}

		CTOS_KBDGet(&c);

		//UP for V7, F1 for V9
		if (c == d_KBD_UP || c == d_KBD_F1) {
			if (curr_off > 0) {
				curr_off--;
			}
			else if (curr_top > 0 && curr_off == 0) {
				curr_top--;
			}
		} else if (c == d_KBD_DOWN || c == d_KBD_F4) {
			if (curr_top + curr_off + 1 < apnum) {
				if (curr_off < max_y - start_y) {
					curr_off++;
				} else if (curr_top + curr_off < apnum) {
					curr_top++;
				}
			}
		} else if (c == d_KBD_ENTER) {
			*selitem = curr_top + curr_off;
			return 0;
		} else if (c == d_KBD_CANCEL) {
			return 1;
		} else if (c >= '1' && c <= '9') {
			*selitem = c - '0' - 1;
			return 0;
		}
	}
}

// Range of pAppSelectedIndex value is 0 to (AppNum-1)    
USHORT OnAppList(IN BYTE AppNum, IN char AppLabel[][d_LABEL_STR_SIZE+1], OUT BYTE *pAppSelectedIndex)
{
//printf("OnAppList 1\n");
  BYTE sHeaderString[17];
    
    
    memset(sHeaderString, 0x00, sizeof(sHeaderString));
    sprintf(sHeaderString, "APP List");
//printf("OnAppList 2\n");    
    if (ShowAPList(2, 6, sHeaderString, strlen(sHeaderString), AppNum, AppLabel, pAppSelectedIndex) != 0)
        return d_EMVAPLIB_ERR_ABORT_TX;
//printf("OnAppList 3\n");    
    return d_EMVAPLIB_OK;
    
}

// Return d_OK to indicate CONFIRMED        
USHORT OnAppSelectedConfirm(IN BOOL IsRequiredbyCard, IN BYTE *pLabel, IN BYTE bLabelLen)
{
  return d_OK;
}
    
BOOL OnTerminalDataGet(IN USHORT usTag, INOUT USHORT *pLen, OUT BYTE *pValue)
{
    
    return FALSE;
}
    
BOOL OnCAPKGet(IN BYTE *pRID, IN BYTE bKeyIndex, OUT BYTE *pModulus, OUT USHORT *pModulusLen, OUT BYTE *pExponent, OUT USHORT *pExponentLen)
{
    
    return FALSE;
}
    
// Return d_OK to indicate Online PIN block is ready for application
USHORT OnOnlinePINBlockGet(OUT ONLINE_PIN_DATA *pOnlinePINData)
{
	return 0;
}
   
static int iTestCancel(void)
{
	return 0;
}

// Return d_OK to indicate Offline PIN block is ready for Kernel
// If this function uses KMS_GetEncOfflinePIN function to get offline pin, return d_EMV_ENTER_KMS_OFFLINEPIN to indicate enciphed offline PIN is ready for Kernel    
USHORT OnOfflinePINBlockGet(void)
{
	return 0;
}

void OnPINVerifyResult(IN USHORT usResult)
{
printf("OnPINVerifyResult 1\n");
   BYTE data[32];
    
   isOfflinePIN = TRUE;
   memset(data, 0, sizeof(data));
    
   if (usResult == d_PIN_RESULT_OK) 
   {
       isPIN_OK = TRUE;
       //"PIN Verify OK"
       sprintf(data, "PIN Verify OK");
   }
   else if (usResult == d_PIN_RESULT_FAIL) 
   {
       isPIN_OK = FALSE;
       //"!PIN Wrong!"
       sprintf(data, "PIN Wrong");
   }
   else if (usResult == d_PIN_RESULT_BLOCKED || usResult == d_PIN_RESULT_FAILBLOCKED) 
   {
       isPIN_OK = FALSE;
       //"!PIN Blocked!"
       sprintf(data, "PIN Blocked");
   }
   
   CTOS_LCDTPrintXY(1, 4, data);
   CTOS_Delay(2000);
	printf("OnPINVerifyResult 2\n");
}

void OnTxnOnline(IN ONLINE_PIN_DATA *pOnlinePINData, OUT EMV_ONLINE_RESPONSE_DATA* pOnlineResponseData)
{
printf("OnTxnOnline 1\n");
    if(pOnlinePINData->bPINLen == 0 && !isInsertPIN)
    {
        isPIN_OK = TRUE;
        pOnlineResponseData->bAction = d_ONLINE_ACTION_APPROVAL;
//        ret = InsertPIN(pOnlinePINData);
    }
    else
    {
        if(isOfflinePIN)
        {
            if(isPIN_OK)
            {
                pOnlineResponseData->bAction = d_ONLINE_ACTION_APPROVAL;
            }
            else
            {
                pOnlineResponseData->bAction = d_ONLINE_ACTION_DECLINE;
            }
        }
        else if(memcmp(SelectedAID, "\xA0\x00\x00\x00\x03", 5) == 0)
        {
            if(memcmp(pOnlinePINData->pPIN, "\x47\x67\x9C\x25\xF8\x48\x73\xA2", 8) == 0) 
            {          
                isPIN_OK = TRUE;
                pOnlineResponseData->bAction = d_ONLINE_ACTION_APPROVAL;
            }
            else
            {                   
                isPIN_OK = FALSE;
                pOnlineResponseData->bAction = d_ONLINE_ACTION_DECLINE;
            }
        }
        else
        {
            if(memcmp(pOnlinePINData->pPIN, "\x5C\x73\xAF\xC9\x85\x28\xCF\xF2", 8) == 0) 
            {
                isPIN_OK = TRUE;
                pOnlineResponseData->bAction = d_ONLINE_ACTION_APPROVAL;                
            }
            else
            {
                isPIN_OK = FALSE;
                pOnlineResponseData->bAction = d_ONLINE_ACTION_DECLINE;                
            }
        }
    }
        
//    CTOS_Delay(1500);
  
//    pOnlineResponseData->bAction = d_ONLINE_ACTION_APPROVAL;
    
    memcpy(baAuthorizationCode, "00", 2);
    pOnlineResponseData->pAuthorizationCode = baAuthorizationCode;
    pOnlineResponseData->pIssuerAuthenticationData = baIssuerAuthenticationData;
    pOnlineResponseData->pIssuerScript = baIssuerScript;
printf("OnTxnOnline 2\n");
}

void OnTxnIssuerScriptResult(IN BYTE* pScriptResult, IN USHORT pScriptResultLen)
{
	
}

void OnTxnResult(IN BYTE bResult, IN BOOL IsSignatureRequired)
{

}

void OnTotalAmountGet(IN BYTE *pPAN, IN BYTE bPANLen, OUT ULONG *pAmount)
{
    *pAmount = 0;
}

void OnExceptionFileCheck(IN BYTE *pPAN, IN BYTE bPANLen, OUT BOOL *isException)
{
	
}

BOOL OnCAPKRevocationCheck(IN BYTE *pbRID, IN BYTE bCAPKIdx, BYTE *pbSerialNumuber)
{
    return FALSE;
}

void OnGetPINNotify(IN BYTE bPINType, IN USHORT bRemainingCounter, OUT BOOL* pIsUseDefaultGetPINFunc, OUT DEFAULT_GETPIN_FUNC_PARA *pPara)
{
printf("OnGetPINNotify 1\n");
  BYTE pan[32];
  
  *pIsUseDefaultGetPINFunc = FALSE;
  isInsertPIN = TRUE;
  
  memset(pPara, 0x00, sizeof(DEFAULT_GETPIN_FUNC_PARA));
  pPara->usLineLeft_X = 5;
  pPara->usLineRight_X = 20;
  pPara->bPINDigitMaxLength = 12;
  pPara->bPINDigitMinLength = 4;
  pPara->usLinePosition_Y = 6;
  pPara->ulTimeout = 300;
  
  if (bPINType == d_NOTIFY_OFFLINE_PIN)
  {
    pPara->IsReverseLine = TRUE;
    pPara->IsRightToLeft = TRUE;
  
    //CTOS_LCDTPrintXY(1, 5, "Enter Offline PIN:");
    CTOS_LCDTPrintXY(1, 3, "Enter Offline PIN:");
  }else
  {
    pPara->ONLINEPIN_PARA.CipherKeyIndex = d_ONLINE_KEYINDEX;
    pPara->ONLINEPIN_PARA.CipherKeySet = d_ONLINE_KEYSET;
    pPara->ONLINEPIN_PARA.bPANLen = 16;
    memset(pan, 0x30, sizeof(pan));
    memset(pPara->ONLINEPIN_PARA.baPAN, 0x30, 16);
            
    //CTOS_LCDTPrintXY(1, 5, "Enter Online PIN:");
    CTOS_LCDTPrintXY(1, 3, "Enter Online PIN:");
  }
printf("OnGetPINNotify 2\n");
}

void OnOutputCardAPDU(IN BYTE *pTxAPDU, IN USHORT TxAPUDLen, IN BYTE *pRxAPDU, IN USHORT RxAPDULen)
{
  BYTE buff[1024];
  
  memset(buff, 0, sizeof(buff));
  CTOS_PrinterPutString("TxAPDU");
  wub_hex_2_str(pTxAPDU, buff, TxAPUDLen);
  CTOS_PrinterPutString(buff);
  
  memset(buff, 0, sizeof(buff));
  CTOS_PrinterPutString("RxAPDU");
  wub_hex_2_str(pRxAPDU, buff, RxAPDULen);
  CTOS_PrinterPutString(buff);
  
}

EMV_EVENT g_emv_event = 
{
    1,
	OnDisplayShow,
    OnErrorMsg, 
    OnEMVConfigActive, 
    NULL,
	OnTxnDataGet, 
    OnAppList,
    OnAppSelectedConfirm,
    OnTerminalDataGet,
    OnCAPKGet,
    OnGetPINNotify,
    OnOnlinePINBlockGet,
    OnOfflinePINBlockGet,
    OnPINVerifyResult,
    OnTxnOnline,
    OnTxnIssuerScriptResult,
    OnTxnResult,
    OnTotalAmountGet,
    OnExceptionFileCheck,
    OnCAPKRevocationCheck,
};


void Polling_Card(void)
{
	BYTE baATQA[2];
	BYTE baSAK;
	BYTE baCSN[20];
	BYTE CSN_LEN;
	BYTE baPUPI[4];	
	BYTE Key;
	USHORT rtn;
    BYTE LCDbuff[32];
	USHORT 	usTk1Len, usTk2Len, usTk3Len;
	BYTE 	baTk1Buf[d_BUFF_SIZE], baTk2Buf[d_BUFF_SIZE], baTk3Buf[d_BUFF_SIZE];
	
	CTOS_KMS2Init();
	rtn = EMV_Initialize(&g_emv_event, d_EMV_CONFIG_FILE); 
    if(rtn != d_OK)
    {
        sprintf(LCDbuff, "initial ret %04X ", rtn);
        CTOS_LCDTPrintXY(1, 6, LCDbuff);     
		return;		
    }
	CTOS_KMS2Erase();
    write_online_key();
    srand(time(NULL));
	
	//Clear MSR
	usTk1Len = usTk2Len = usTk3Len = d_BUFF_SIZE;
	CTOS_MSRRead(baTk1Buf, &usTk1Len, baTk2Buf, &usTk2Len, baTk3Buf, &usTk3Len);

	while(Key != d_KBD_CANCEL){
		CTOS_KBDHit(&Key);
        if(d_OK == VW_TypeA_ActiveIdle(0, baATQA, &baSAK, &CSN_LEN, baCSN))
        {

            StartTrans();
            return;
        }
        CTOS_Delay(10);

        if(d_OK == VW_TypeB_PowerOn(baPUPI))
        {

            StartTrans();   
            return;
        }

        if(d_OK == EMVPolling())
        {
            return;
        }
	}
}

//---------------------------------------------------------------------------

void ShowTitle(char *caStr) {
    CTOS_LCDTClearDisplay();
    CTOS_LCDTSetReverse(d_TRUE);
    CTOS_LCDTPrintXY(1, 1, caStr);
    CTOS_LCDTSetReverse(d_FALSE);
}

/**
 ** The main entry of the terminal application
 **/
int main(int argc, char *argv[]) {
    BYTE bKey, debugbuf[16];
    BYTE ShowData[128];
	BYTE PresentMsg1[32];
	BYTE PresentMsg2[64];
	BYTE buf[32];

    //SelectTTFFont();
	CTOS_LCDGShowBMPPic(0, 0, "Welcome.bmp");

    ulAPRtn = VW_InitComm(d_VW_COMM_COM2, d_BAUDRATE);

    if (ulAPRtn != d_NO_ERROR) {
        CTOS_LCDTPrintXY(1, 6, "InitCom Fail");
        CTOS_KBDGet(&bKey);
    } else {
        iBatchNo = 0;
        while (1) {
			CTOS_LCDGShowBMPPic(0, 0, "Welcome.bmp");
			CTOS_LCDTPrintXY(1, 8, " Enter Sale Amount: ");
			CTOS_LCDTPrintXY(1, 9, "   $          0.00  ");
			ulAPRtn = InputValue();
			if (ulAPRtn == FALSE) {
				break;
			}
			
			ulAPRtn = MsessionAuthen();
			if (ulAPRtn != d_NO_ERROR) {
				CTOS_LCDTPrintXY(1, 8, "Authen Fail , any key to Exit");
				CTOS_KBDGet(&bKey);
				CTOS_PowerOff();
			}
			CTOS_LCDGShowBMPPic(0, 0, "TapOnQP.bmp");
			
			memset(buf, 0x00, sizeof(buf));
			sprintf(PresentMsg1, "Present Card...");
			
			if(iLen == 1)
				sprintf(buf, "0.0%1s", (char *)baInput);
			else if(iLen == 2)
				sprintf(buf, "0.%2s", (char *)baInput);
			
			else{
				int k;
				
				for(k = 0; k < (iLen-2); k++){
					strncat(buf, &baInput[k], 1);
				}
				strcat(buf, ".");
				strncat(buf, &baInput[iLen-2], 1);
				strncat(buf, &baInput[iLen-1], 1);
			}
				
			VW_SetLCDBackLight(d_VW_ON);
			sprintf(PresentMsg2, "Amount $%s", (char *)buf);
			VW_Display(0x01, 1, 1, PresentMsg1, strlen(PresentMsg1));
			VW_Display(0x00, 1, 2, PresentMsg2, strlen(PresentMsg2));
			
			Polling_Card();

            CTOS_Delay(1000);

            bKey = d_KBD_ENTER;
            if (bKey == d_KBD_CLEAR) {
                CTOS_LCDTClearDisplay();
                CTOS_LCDTPrintXY(1, 8, "OK to Power Off.");
                CTOS_KBDGet(&bKey);
                if (bKey == d_KBD_ENTER)
                    CTOS_PowerOff();
            }
        }
    }
    
    exit(0);
}


